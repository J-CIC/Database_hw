<layout name="layout" />

<script src="__PUBLIC__/js/echarts.min.js"></script>
<style type="text/css">
    #charts{
        width: 80%;
        height: 500px;
    }
    #charts2{
        width: 80%;
        height: 500px;
    }
</style>
<div class="row">
    <div class="col-lg-12">
        <h1 class="page-header">订单时间分析</h1>
    </div>
    <!-- /.col-lg-12 -->
</div>
<!-- /.row -->
<div class="row">
    <div id="charts">
        
    </div>
    <div id="charts2">
        
    </div>
</div>
<script type="text/javascript">
    var mycharts = echarts.init(document.getElementById("charts"));
    var mycharts2 = echarts.init(document.getElementById("charts2"));
    mycharts2.showLoading();
    mycharts.showLoading();
    $.ajax({
        type: 'POST',
        url: "OrderTimeDistribution",
        data: {
            
        },
        success: function(data, textStatus){

            console.info(data);
            var times = data.times;
            data = data.ranks;
            var x = [];
            var y = [];
            for(var i=data.length-1;i>=0;i--){
                x.push(data[i].pay_sum/100)
                y.push(data[i].times)
            }
            var option = {
                title: {
                    text: '销售额排行图',
                    subtext: '以天为单位'
                },
                tooltip: {
                    trigger: 'axis',
                    axisPointer: {
                        type: 'shadow'
                    }
                },
                grid: {
                    left: '3%',
                    right: '4%',
                    bottom: '3%',
                    containLabel: true
                }, 
                toolbox: {
                    feature: {
                        saveAsImage: {}
                    }
                },
                xAxis: {
                    type: 'value',
                    boundaryGap: [0, 0.01],
                    axisLabel:{
                        formatter:"{value}元"
                    }
                },
                yAxis: {
                    type: 'category',
                    data: y
                },
                series: [
                    {
                        name: '销量',
                        type: 'bar',
                        data: x,
                        itemStyle:{
                            normal:{
                                color:'#337ab7',
                                formatter:'{c}元'
                            }
                        },
                        label:{
                            normal:{
                                show:true,
                                formatter:'{c}元'
                            }
                        }
                    },
                ]
            };
            mycharts.hideLoading();
            mycharts.setOption(option);
            setImage(times);
        },
        error:function(XMLHttpRequest, textStatus, errorThrown){
            console.log(textStatus);
        },
        dataType: "JSON"
    });
    function setImage(data){
        var x = [];
        var y = [];
        for(var i=0;i<data.length;i++){
            y.push(data[i].pay_sum/100)
            x.push(data[i].times)
        }
        option = {
            title: {
                text: '全月销售额'
            },
            tooltip: {
                trigger: 'axis'
            },
            legend: {
                data:['销售额']
            },
            grid: {
                left: '3%',
                right: '4%',
                bottom: '3%',
                containLabel: true
            },
            toolbox: {
                feature: {
                    saveAsImage: {}
                }
            },
            xAxis: {
                type: 'category',
                boundaryGap: false,
                data: x
            },
            yAxis: {
                type: 'value'
            },
            series: [
                {
                    name:'销售额',
                    type:'line',
                    stack: '总量',
                    data:y
                },
            ]
        };
        mycharts2.hideLoading();
        mycharts2.setOption(option);
    }
</script>